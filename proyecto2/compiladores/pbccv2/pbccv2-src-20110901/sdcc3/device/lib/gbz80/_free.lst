                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.0.1 #6227 (Oct  2 2015) (Linux)
                              4 ; This file was generated Fri Oct  2 17:18:20 2015
                              5 ;--------------------------------------------------------
                              6 	.module _free
                              7 	.optsdcc -mgbz80
                              8 	
                              9 ;--------------------------------------------------------
                             10 ; Public variables in this module
                             11 ;--------------------------------------------------------
                             12 	.globl __sdcc_find_memheader
                             13 	.globl __sdcc_prev_memheader
                             14 	.globl _free
                             15 ;--------------------------------------------------------
                             16 ;  ram data
                             17 ;--------------------------------------------------------
                             18 	.area _DATA
   0000                      19 __sdcc_prev_memheader::
   0000                      20 	.ds 2
                             21 ;--------------------------------------------------------
                             22 ; overlayable items in  ram 
                             23 ;--------------------------------------------------------
                             24 	.area _OVERLAY
                             25 ;--------------------------------------------------------
                             26 ; external initialized ram data
                             27 ;--------------------------------------------------------
                             28 ;--------------------------------------------------------
                             29 ; global & static initialisations
                             30 ;--------------------------------------------------------
                             31 	.area _HOME
                             32 	.area _GSINIT
                             33 	.area _GSFINAL
                             34 	.area _GSINIT
                             35 ;--------------------------------------------------------
                             36 ; Home
                             37 ;--------------------------------------------------------
                             38 	.area _HOME
                             39 	.area _HOME
                             40 ;--------------------------------------------------------
                             41 ; code
                             42 ;--------------------------------------------------------
                             43 	.area _CODE
                             44 ;../_free.c:62: _sdcc_find_memheader(void * p)
                             45 ;	---------------------------------
                             46 ; Function _sdcc_find_memheader
                             47 ; ---------------------------------
   0000                      48 __sdcc_find_memheader_start::
   0000                      49 __sdcc_find_memheader:
                             50 	
   0000 F5                   51 	push	af
                             52 ;../_free.c:65: if (!p)
   0001 F8 04                53 	ldhl	sp,#4
   0003 7E                   54 	ld	a,(hl)
   0004 23                   55 	inc	hl
   0005 B6                   56 	or	a,(hl)
   0006 C2r0Es00             57 	jp	NZ,00102$
                             58 ;../_free.c:66: return NULL;
   0009 11 00 00             59 	ld	de,#0x0000
   000C 18 29                60 	jr	00103$
   000E                      61 00102$:
                             62 ;../_free.c:67: pthis = (MEMHEADER * )((char *)  p - HEADER_SIZE); //to start of header
   000E F8 05                63 	ldhl	sp,#5
   0010 2B                   64 	dec	hl
   0011 4E                   65 	ld	c,(hl)
   0012 23                   66 	inc	hl
   0013 46                   67 	ld	b,(hl)
   0014 11 06 00             68 	ld	de,#0x0006
   0017 79                   69 	ld	a,c
   0018 93                   70 	sub	a,e
   0019 5F                   71 	ld	e,a
   001A 78                   72 	ld	a,b
   001B 9A                   73 	sbc	a,d
   001C F8 01                74 	ldhl	sp,#1
   001E 77                   75 	ld	(hl),a
   001F 2B                   76 	dec	hl
   0020 73                   77 	ld	(hl),e
                             78 ;../_free.c:68: _sdcc_prev_memheader = pthis->prev;
   0021 4E                   79 	ld	c,(hl)
   0022 23                   80 	inc	hl
   0023 46                   81 	ld	b,(hl)
   0024 03                   82 	inc	bc
   0025 03                   83 	inc	bc
   0026 59                   84 	ld	e,c
   0027 50                   85 	ld	d,b
   0028 1A                   86 	ld	a,(de)
   0029 21r00s00             87 	ld	hl,#__sdcc_prev_memheader
   002C 77                   88 	ld	(hl),a
   002D 13                   89 	inc	de
   002E 1A                   90 	ld	a,(de)
   002F 23                   91 	inc	hl
   0030 77                   92 	ld	(hl),a
                             93 ;../_free.c:70: return (pthis);
   0031 F8 01                94 	ldhl	sp,#1
   0033 2B                   95 	dec	hl
   0034 5E                   96 	ld	e,(hl)
   0035 23                   97 	inc	hl
   0036 56                   98 	ld	d,(hl)
   0037                      99 00103$:
   0037 E8 02               100 	lda	sp,2(sp)
   0039 C9                  101 	ret
   003A                     102 __sdcc_find_memheader_end::
                            103 ;../_free.c:74: free (void *p)
                            104 ;	---------------------------------
                            105 ; Function free
                            106 ; ---------------------------------
   003A                     107 _free_start::
   003A                     108 _free:
                            109 	
   003A F5                  110 	push	af
   003B F5                  111 	push	af
                            112 ;../_free.c:78: if ( p ) //For allocated pointers only!
   003C F8 06               113 	ldhl	sp,#6
   003E 7E                  114 	ld	a,(hl)
   003F 23                  115 	inc	hl
   0040 B6                  116 	or	a,(hl)
   0041 CArA8s00            117 	jp	Z,00108$
                            118 ;../_free.c:95: }
   0044 F3                  119 	di
                            120 ;../_free.c:81: pthis = (MEMHEADER * )((char *)  p - HEADER_SIZE); //to start of header
   0045 2B                  121 	dec	hl
   0046 4E                  122 	ld	c,(hl)
   0047 23                  123 	inc	hl
   0048 46                  124 	ld	b,(hl)
   0049 11 06 00            125 	ld	de,#0x0006
   004C 79                  126 	ld	a,c
   004D 93                  127 	sub	a,e
   004E 5F                  128 	ld	e,a
   004F 78                  129 	ld	a,b
   0050 9A                  130 	sbc	a,d
   0051 F8 01               131 	ldhl	sp,#1
   0053 77                  132 	ld	(hl),a
   0054 2B                  133 	dec	hl
   0055 73                  134 	ld	(hl),e
                            135 ;../_free.c:82: if ( pthis->prev ) // For the regular header
   0056 4E                  136 	ld	c,(hl)
   0057 23                  137 	inc	hl
   0058 46                  138 	ld	b,(hl)
   0059 03                  139 	inc	bc
   005A 03                  140 	inc	bc
   005B 59                  141 	ld	e,c
   005C 50                  142 	ld	d,b
   005D 1A                  143 	ld	a,(de)
   005E 4F                  144 	ld	c,a
   005F 13                  145 	inc	de
   0060 1A                  146 	ld	a,(de)
   0061 47                  147 	ld	b,a
   0062 B1                  148 	or	a,c
   0063 CAr92s00            149 	jp	Z,00104$
                            150 ;../_free.c:84: prev_header = pthis->prev;
   0066 23                  151 	inc	hl
   0067 71                  152 	ld	(hl),c
   0068 23                  153 	inc	hl
   0069 70                  154 	ld	(hl),b
                            155 ;../_free.c:85: prev_header->next = pthis->next;
   006A 2B                  156 	dec	hl
   006B 2B                  157 	dec	hl
   006C 2B                  158 	dec	hl
   006D 5E                  159 	ld	e,(hl)
   006E 23                  160 	inc	hl
   006F 56                  161 	ld	d,(hl)
   0070 1A                  162 	ld	a,(de)
   0071 4F                  163 	ld	c,a
   0072 13                  164 	inc	de
   0073 1A                  165 	ld	a,(de)
   0074 47                  166 	ld	b,a
   0075 23                  167 	inc	hl
   0076 23                  168 	inc	hl
   0077 2B                  169 	dec	hl
   0078 5E                  170 	ld	e,(hl)
   0079 23                  171 	inc	hl
   007A 56                  172 	ld	d,(hl)
   007B 79                  173 	ld	a,c
   007C 12                  174 	ld	(de),a
   007D 13                  175 	inc	de
   007E 78                  176 	ld	a,b
   007F 12                  177 	ld	(de),a
                            178 ;../_free.c:86: if (pthis->next)
   0080 79                  179 	ld	a,c
   0081 B0                  180 	or	a,b
   0082 CArA7s00            181 	jp	Z,00105$
                            182 ;../_free.c:88: pthis->next->prev = prev_header;
   0085 03                  183 	inc	bc
   0086 03                  184 	inc	bc
   0087 59                  185 	ld	e,c
   0088 50                  186 	ld	d,b
   0089 2B                  187 	dec	hl
   008A 7E                  188 	ld	a,(hl)
   008B 12                  189 	ld	(de),a
   008C 13                  190 	inc	de
   008D 23                  191 	inc	hl
   008E 7E                  192 	ld	a,(hl)
   008F 12                  193 	ld	(de),a
   0090 18 15               194 	jr	00105$
   0092                     195 00104$:
                            196 ;../_free.c:93: pthis->len = 0; //For the first header
   0092 F8 01               197 	ldhl	sp,#1
   0094 2B                  198 	dec	hl
   0095 5E                  199 	ld	e,(hl)
   0096 23                  200 	inc	hl
   0097 56                  201 	ld	d,(hl)
   0098 21 04 00            202 	ld	hl,#0x0004
   009B 19                  203 	add	hl,de
   009C 4D                  204 	ld	c,l
   009D 44                  205 	ld	b,h
   009E 59                  206 	ld	e,c
   009F 50                  207 	ld	d,b
   00A0 3E 00               208 	ld	a,#0x00
   00A2 12                  209 	ld	(de),a
   00A3 13                  210 	inc	de
   00A4 3E 00               211 	ld	a,#0x00
   00A6 12                  212 	ld	(de),a
   00A7                     213 00105$:
   00A7 FB                  214 	ei
   00A8                     215 00108$:
   00A8 E8 04               216 	lda	sp,4(sp)
   00AA C9                  217 	ret
   00AB                     218 _free_end::
                            219 	.area _CODE
                            220 	.area _CABS
