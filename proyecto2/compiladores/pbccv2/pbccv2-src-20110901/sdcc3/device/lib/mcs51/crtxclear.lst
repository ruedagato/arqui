                              1 ;--------------------------------------------------------------------------
                              2 ;  crtxclear.asm - C run-time: clear XSEG
                              3 ;
                              4 ;  Copyright (C) 2004, Erik Petrich
                              5 ;
                              6 ;  This library is free software; you can redistribute it and/or modify it
                              7 ;  under the terms of the GNU General Public License as published by the
                              8 ;  Free Software Foundation; either version 2.1, or (at your option) any
                              9 ;  later version.
                             10 ;
                             11 ;  This library is distributed in the hope that it will be useful,
                             12 ;  but WITHOUT ANY WARRANTY; without even the implied warranty of
                             13 ;  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
                             14 ;  GNU General Public License for more details.
                             15 ;
                             16 ;  You should have received a copy of the GNU General Public License 
                             17 ;  along with this library; see the file COPYING. If not, write to the
                             18 ;  Free Software Foundation, 51 Franklin Street, Fifth Floor, Boston,
                             19 ;   MA 02110-1301, USA.
                             20 ;
                             21 ;  As a special exception, if you link this library with other files,
                             22 ;  some of which are compiled with SDCC, to produce an executable,
                             23 ;  this library does not by itself cause the resulting executable to
                             24 ;  be covered by the GNU General Public License. This exception does
                             25 ;  not however invalidate any other reasons why the executable file
                             26 ;  might be covered by the GNU General Public License.
                             27 ;--------------------------------------------------------------------------
                             28 
                             29 	.area CSEG    (CODE)
                             30 	.area GSINIT0 (CODE)
                             31 	.area GSINIT1 (CODE)
                             32 	.area GSINIT2 (CODE)
                             33 	.area GSINIT3 (CODE)
                             34 	.area GSINIT4 (CODE)
                             35 	.area GSINIT5 (CODE)
                             36 	.area GSINIT  (CODE)
                             37 	.area GSFINAL (CODE)
                             38 
                             39 	.area GSINIT4 (CODE)
                             40 
   0000                      41 __mcs51_genXRAMCLEAR::
   0000 78r00                42 	mov	r0,#l_PSEG
   0002 E8                   43 	mov	a,r0
   0003 44s00                44 	orl	a,#(l_PSEG >> 8)
   0005 60 0A                45 	jz	00006$
   0007 79r00                46 	mov	r1,#s_PSEG
   0009 75*00s00             47 	mov	__XPAGE,#(s_PSEG >> 8)
   000C E4                   48 	clr     a
   000D F3                   49 00005$:	movx	@r1,a
   000E 09                   50 	inc	r1
   000F D8 FC                51 	djnz	r0,00005$
                             52 
   0011                      53 00006$:
   0011 78r00                54 	mov	r0,#l_XSEG
   0013 E8                   55 	mov	a,r0
   0014 44s00                56 	orl	a,#(l_XSEG >> 8)
   0016 60 0C                57 	jz	00008$
   0018 79s00                58 	mov	r1,#((l_XSEG + 255) >> 8)
   001A 90s00r00             59 	mov	dptr,#s_XSEG
   001D E4                   60 	clr     a
   001E F0                   61 00007$:	movx	@dptr,a
   001F A3                   62 	inc	dptr
   0020 D8 FC                63 	djnz	r0,00007$
   0022 D9 FA                64 	djnz	r1,00007$
   0024                      65 00008$:
                             66 
