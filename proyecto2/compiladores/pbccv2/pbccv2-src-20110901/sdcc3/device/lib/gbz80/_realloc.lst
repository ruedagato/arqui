                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 3.0.1 #6227 (Oct  2 2015) (Linux)
                              4 ; This file was generated Fri Oct  2 17:18:20 2015
                              5 ;--------------------------------------------------------
                              6 	.module _realloc
                              7 	.optsdcc -mgbz80
                              8 	
                              9 ;--------------------------------------------------------
                             10 ; Public variables in this module
                             11 ;--------------------------------------------------------
                             12 	.globl _realloc
                             13 ;--------------------------------------------------------
                             14 ;  ram data
                             15 ;--------------------------------------------------------
                             16 	.area _DATA
                             17 ;--------------------------------------------------------
                             18 ; overlayable items in  ram 
                             19 ;--------------------------------------------------------
                             20 	.area _OVERLAY
                             21 ;--------------------------------------------------------
                             22 ; external initialized ram data
                             23 ;--------------------------------------------------------
                             24 ;--------------------------------------------------------
                             25 ; global & static initialisations
                             26 ;--------------------------------------------------------
                             27 	.area _HOME
                             28 	.area _GSINIT
                             29 	.area _GSFINAL
                             30 	.area _GSINIT
                             31 ;--------------------------------------------------------
                             32 ; Home
                             33 ;--------------------------------------------------------
                             34 	.area _HOME
                             35 	.area _HOME
                             36 ;--------------------------------------------------------
                             37 ; code
                             38 ;--------------------------------------------------------
                             39 	.area _CODE
                             40 ;../_realloc.c:84: void __xdata * realloc (void * p, size_t size)
                             41 ;	---------------------------------
                             42 ; Function realloc
                             43 ; ---------------------------------
   0000                      44 _realloc_start::
   0000                      45 _realloc:
   0000 E8 F6                46 	lda	sp,-10(sp)
                             47 ;../_realloc.c:142: }
   0002 F3                   48 	di
                             49 ;../_realloc.c:92: pthis = _sdcc_find_memheader(p);
   0003 F8 0C                50 	ldhl	sp,#12
   0005 7E                   51 	ld	a,(hl)
   0006 23                   52 	inc	hl
   0007 66                   53 	ld	h,(hl)
   0008 6F                   54 	ld	l,a
   0009 E5                   55 	push	hl
   000A CDr00s00             56 	call	__sdcc_find_memheader
   000D E8 02                57 	lda	sp,2(sp)
   000F 42                   58 	ld	b,d
   0010 4B                   59 	ld	c,e
   0011 F8 08                60 	ldhl	sp,#8
   0013 71                   61 	ld	(hl),c
   0014 23                   62 	inc	hl
   0015 70                   63 	ld	(hl),b
                             64 ;../_realloc.c:93: if (pthis)
   0016 2B                   65 	dec	hl
   0017 7E                   66 	ld	a,(hl)
   0018 23                   67 	inc	hl
   0019 B6                   68 	or	a,(hl)
   001A CArF1s01             69 	jp	Z,00114$
                             70 ;../_realloc.c:95: if (size > (0xFFFF-HEADER_SIZE))
   001D F8 0E                71 	ldhl	sp,#14
   001F 3E F9                72 	ld	a, #0xF9
   0021 96                   73 	sub	a, (hl)
   0022 23                   74 	inc	hl
   0023 3E FF                75 	ld	a, #0xFF
   0025 9E                   76 	sbc	a, (hl)
   0026 D2r33s00             77 	jp	NC,00111$
                             78 ;../_realloc.c:97: ret = (void __xdata *) NULL; //To prevent overflow in next line
   0029 F8 04                79 	ldhl	sp,#4
   002B 36 00                80 	ld	(hl),#0x00
   002D 23                   81 	inc	hl
   002E 36 00                82 	ld	(hl),#0x00
   0030 C3r04s02             83 	jp	00115$
   0033                      84 00111$:
                             85 ;../_realloc.c:101: size += HEADER_SIZE; //We need a memory for header too
   0033 F8 0F                86 	ldhl	sp,#15
   0035 2B                   87 	dec	hl
   0036 5E                   88 	ld	e,(hl)
   0037 23                   89 	inc	hl
   0038 56                   90 	ld	d,(hl)
   0039 21 06 00             91 	ld	hl,#0x0006
   003C 19                   92 	add	hl,de
   003D 7D                   93 	ld	a,l
   003E 54                   94 	ld	d,h
   003F F8 0E                95 	ldhl	sp,#14
   0041 77                   96 	ld	(hl),a
   0042 23                   97 	inc	hl
   0043 72                   98 	ld	(hl),d
                             99 ;../_realloc.c:103: if ((((unsigned int)pthis->next) - ((unsigned int)pthis)) >= size)
   0044 F8 09               100 	ldhl	sp,#9
   0046 2B                  101 	dec	hl
   0047 5E                  102 	ld	e,(hl)
   0048 23                  103 	inc	hl
   0049 56                  104 	ld	d,(hl)
   004A 1A                  105 	ld	a,(de)
   004B F8 02               106 	ldhl	sp,#2
   004D 77                  107 	ld	(hl),a
   004E 13                  108 	inc	de
   004F 1A                  109 	ld	a,(de)
   0050 23                  110 	inc	hl
   0051 77                  111 	ld	(hl),a
   0052 2B                  112 	dec	hl
   0053 7E                  113 	ld	a,(hl)
   0054 2B                  114 	dec	hl
   0055 2B                  115 	dec	hl
   0056 77                  116 	ld	(hl),a
   0057 F8 03               117 	ldhl	sp,#3
   0059 7E                  118 	ld	a,(hl)
   005A 2B                  119 	dec	hl
   005B 2B                  120 	dec	hl
   005C 77                  121 	ld	(hl),a
   005D F8 08               122 	ldhl	sp,#8
   005F 4E                  123 	ld	c,(hl)
   0060 23                  124 	inc	hl
   0061 46                  125 	ld	b,(hl)
   0062 F8 01               126 	ldhl	sp,#1
   0064 2B                  127 	dec	hl
   0065 5E                  128 	ld	e,(hl)
   0066 23                  129 	inc	hl
   0067 56                  130 	ld	d,(hl)
   0068 7B                  131 	ld	a,e
   0069 91                  132 	sub	a,c
   006A 5F                  133 	ld	e,a
   006B 7A                  134 	ld	a,d
   006C 98                  135 	sbc	a,b
   006D 47                  136 	ld	b,a
   006E 4B                  137 	ld	c,e
   006F F8 0E               138 	ldhl	sp,#14
   0071 79                  139 	ld	a, c
   0072 96                  140 	sub	a, (hl)
   0073 23                  141 	inc	hl
   0074 78                  142 	ld	a, b
   0075 9E                  143 	sbc	a, (hl)
   0076 DAr9Cs00            144 	jp	C,00108$
                            145 ;../_realloc.c:105: pthis->len = size;
   0079 F8 09               146 	ldhl	sp,#9
   007B 2B                  147 	dec	hl
   007C 5E                  148 	ld	e,(hl)
   007D 23                  149 	inc	hl
   007E 56                  150 	ld	d,(hl)
   007F 21 04 00            151 	ld	hl,#0x0004
   0082 19                  152 	add	hl,de
   0083 4D                  153 	ld	c,l
   0084 44                  154 	ld	b,h
   0085 59                  155 	ld	e,c
   0086 50                  156 	ld	d,b
   0087 F8 0E               157 	ldhl	sp,#14
   0089 7E                  158 	ld	a,(hl)
   008A 12                  159 	ld	(de),a
   008B 13                  160 	inc	de
   008C 23                  161 	inc	hl
   008D 7E                  162 	ld	a,(hl)
   008E 12                  163 	ld	(de),a
                            164 ;../_realloc.c:106: ret = p;
   008F F8 0C               165 	ldhl	sp,#12
   0091 7E                  166 	ld	a,(hl)
   0092 23                  167 	inc	hl
   0093 5E                  168 	ld	e,(hl)
   0094 F8 04               169 	ldhl	sp,#4
   0096 77                  170 	ld	(hl),a
   0097 23                  171 	inc	hl
   0098 73                  172 	ld	(hl),e
   0099 C3r04s02            173 	jp	00115$
   009C                     174 00108$:
                            175 ;../_realloc.c:110: if ((_sdcc_prev_memheader) &&
   009C 21r00s00            176 	ld	hl,#__sdcc_prev_memheader
   009F 7E                  177 	ld	a,(hl)
   00A0 23                  178 	inc	hl
   00A1 B6                  179 	or	a,(hl)
   00A2 CAr7Fs01            180 	jp	Z,00104$
                            181 ;../_realloc.c:111: ((((unsigned int)pthis->next) -
   00A5 F8 03               182 	ldhl	sp,#3
   00A7 2B                  183 	dec	hl
   00A8 4E                  184 	ld	c,(hl)
   00A9 23                  185 	inc	hl
   00AA 46                  186 	ld	b,(hl)
   00AB F8 00               187 	ldhl	sp,#0
   00AD 71                  188 	ld	(hl),c
   00AE 23                  189 	inc	hl
   00AF 70                  190 	ld	(hl),b
                            191 ;../_realloc.c:112: ((unsigned int)_sdcc_prev_memheader) -
   00B0 21r00s00            192 	ld	hl,#__sdcc_prev_memheader
   00B3 4E                  193 	ld	c,(hl)
   00B4 23                  194 	inc	hl
   00B5 46                  195 	ld	b,(hl)
   00B6 F8 01               196 	ldhl	sp,#1
   00B8 2B                  197 	dec	hl
   00B9 5E                  198 	ld	e,(hl)
   00BA 23                  199 	inc	hl
   00BB 56                  200 	ld	d,(hl)
   00BC 7B                  201 	ld	a,e
   00BD 91                  202 	sub	a,c
   00BE 5F                  203 	ld	e,a
   00BF 7A                  204 	ld	a,d
   00C0 98                  205 	sbc	a,b
   00C1 77                  206 	ld	(hl),a
   00C2 2B                  207 	dec	hl
   00C3 73                  208 	ld	(hl),e
                            209 ;../_realloc.c:113: _sdcc_prev_memheader->len) >= size))
   00C4 21r01s00            210 	ld	hl,#__sdcc_prev_memheader + 1
   00C7 2B                  211 	dec	hl
   00C8 4E                  212 	ld	c,(hl)
   00C9 23                  213 	inc	hl
   00CA 46                  214 	ld	b,(hl)
   00CB 03                  215 	inc	bc
   00CC 03                  216 	inc	bc
   00CD 03                  217 	inc	bc
   00CE 03                  218 	inc	bc
   00CF 59                  219 	ld	e,c
   00D0 50                  220 	ld	d,b
   00D1 1A                  221 	ld	a,(de)
   00D2 4F                  222 	ld	c,a
   00D3 13                  223 	inc	de
   00D4 1A                  224 	ld	a,(de)
   00D5 47                  225 	ld	b,a
   00D6 F8 01               226 	ldhl	sp,#1
   00D8 2B                  227 	dec	hl
   00D9 5E                  228 	ld	e,(hl)
   00DA 23                  229 	inc	hl
   00DB 56                  230 	ld	d,(hl)
   00DC 7B                  231 	ld	a,e
   00DD 91                  232 	sub	a,c
   00DE 5F                  233 	ld	e,a
   00DF 7A                  234 	ld	a,d
   00E0 98                  235 	sbc	a,b
   00E1 47                  236 	ld	b,a
   00E2 4B                  237 	ld	c,e
   00E3 F8 0E               238 	ldhl	sp,#14
   00E5 79                  239 	ld	a, c
   00E6 96                  240 	sub	a, (hl)
   00E7 23                  241 	inc	hl
   00E8 78                  242 	ld	a, b
   00E9 9E                  243 	sbc	a, (hl)
   00EA DAr7Fs01            244 	jp	C,00104$
                            245 ;../_realloc.c:115: pnew = (MEMHEADER __xdata * )((char __xdata *)_sdcc_prev_memheader + _sdcc_prev_memheader->len);
   00ED 21r01s00            246 	ld	hl,#__sdcc_prev_memheader + 1
   00F0 2B                  247 	dec	hl
   00F1 4E                  248 	ld	c,(hl)
   00F2 23                  249 	inc	hl
   00F3 46                  250 	ld	b,(hl)
   00F4 03                  251 	inc	bc
   00F5 03                  252 	inc	bc
   00F6 03                  253 	inc	bc
   00F7 03                  254 	inc	bc
   00F8 59                  255 	ld	e,c
   00F9 50                  256 	ld	d,b
   00FA 1A                  257 	ld	a,(de)
   00FB 4F                  258 	ld	c,a
   00FC 13                  259 	inc	de
   00FD 1A                  260 	ld	a,(de)
   00FE 47                  261 	ld	b,a
   00FF 2B                  262 	dec	hl
   0100 7E                  263 	ld	a,(hl)
   0101 81                  264 	add	a,c
   0102 23                  265 	inc	hl
   0103 4F                  266 	ld	c,a
   0104 7E                  267 	ld	a,(hl)
   0105 88                  268 	adc	a,b
   0106 47                  269 	ld	b,a
   0107 F8 06               270 	ldhl	sp,#6
   0109 71                  271 	ld	(hl),c
   010A 23                  272 	inc	hl
   010B 70                  273 	ld	(hl),b
                            274 ;../_realloc.c:116: _sdcc_prev_memheader->next = pnew;
   010C 21r01s00            275 	ld	hl,#__sdcc_prev_memheader + 1
   010F 2B                  276 	dec	hl
   0110 4E                  277 	ld	c,(hl)
   0111 23                  278 	inc	hl
   0112 46                  279 	ld	b,(hl)
   0113 59                  280 	ld	e,c
   0114 50                  281 	ld	d,b
   0115 F8 06               282 	ldhl	sp,#6
   0117 7E                  283 	ld	a,(hl)
   0118 12                  284 	ld	(de),a
   0119 13                  285 	inc	de
   011A 23                  286 	inc	hl
   011B 7E                  287 	ld	a,(hl)
   011C 12                  288 	ld	(de),a
                            289 ;../_realloc.c:119: pthis->next->prev = pnew;
   011D F8 02               290 	ldhl	sp,#2
   011F 4E                  291 	ld	c,(hl)
   0120 23                  292 	inc	hl
   0121 46                  293 	ld	b,(hl)
   0122 03                  294 	inc	bc
   0123 03                  295 	inc	bc
   0124 59                  296 	ld	e,c
   0125 50                  297 	ld	d,b
   0126 F8 06               298 	ldhl	sp,#6
   0128 7E                  299 	ld	a,(hl)
   0129 12                  300 	ld	(de),a
   012A 13                  301 	inc	de
   012B 23                  302 	inc	hl
   012C 7E                  303 	ld	a,(hl)
   012D 12                  304 	ld	(de),a
                            305 ;../_realloc.c:122: memmove(pnew, pthis, pthis->len);
   012E 23                  306 	inc	hl
   012F 23                  307 	inc	hl
   0130 2B                  308 	dec	hl
   0131 5E                  309 	ld	e,(hl)
   0132 23                  310 	inc	hl
   0133 56                  311 	ld	d,(hl)
   0134 21 04 00            312 	ld	hl,#0x0004
   0137 19                  313 	add	hl,de
   0138 4D                  314 	ld	c,l
   0139 44                  315 	ld	b,h
   013A 59                  316 	ld	e,c
   013B 50                  317 	ld	d,b
   013C 1A                  318 	ld	a,(de)
   013D 4F                  319 	ld	c,a
   013E 13                  320 	inc	de
   013F 1A                  321 	ld	a,(de)
   0140 47                  322 	ld	b,a
   0141 C5                  323 	push	bc
   0142 F8 0A               324 	ldhl	sp,#10
   0144 7E                  325 	ld	a,(hl)
   0145 23                  326 	inc	hl
   0146 66                  327 	ld	h,(hl)
   0147 6F                  328 	ld	l,a
   0148 E5                  329 	push	hl
   0149 F8 0A               330 	ldhl	sp,#10
   014B 7E                  331 	ld	a,(hl)
   014C 23                  332 	inc	hl
   014D 66                  333 	ld	h,(hl)
   014E 6F                  334 	ld	l,a
   014F E5                  335 	push	hl
   0150 CDr00s00            336 	call	_memmove
   0153 E8 06               337 	lda	sp,6(sp)
                            338 ;../_realloc.c:123: pnew->len = size;
   0155 F8 07               339 	ldhl	sp,#7
   0157 2B                  340 	dec	hl
   0158 5E                  341 	ld	e,(hl)
   0159 23                  342 	inc	hl
   015A 56                  343 	ld	d,(hl)
   015B 21 04 00            344 	ld	hl,#0x0004
   015E 19                  345 	add	hl,de
   015F 4D                  346 	ld	c,l
   0160 44                  347 	ld	b,h
   0161 59                  348 	ld	e,c
   0162 50                  349 	ld	d,b
   0163 F8 0E               350 	ldhl	sp,#14
   0165 7E                  351 	ld	a,(hl)
   0166 12                  352 	ld	(de),a
   0167 13                  353 	inc	de
   0168 23                  354 	inc	hl
   0169 7E                  355 	ld	a,(hl)
   016A 12                  356 	ld	(de),a
                            357 ;../_realloc.c:124: ret = MEM(pnew);
   016B F8 07               358 	ldhl	sp,#7
   016D 2B                  359 	dec	hl
   016E 5E                  360 	ld	e,(hl)
   016F 23                  361 	inc	hl
   0170 56                  362 	ld	d,(hl)
   0171 21 06 00            363 	ld	hl,#0x0006
   0174 19                  364 	add	hl,de
   0175 7D                  365 	ld	a,l
   0176 54                  366 	ld	d,h
   0177 F8 04               367 	ldhl	sp,#4
   0179 77                  368 	ld	(hl),a
   017A 23                  369 	inc	hl
   017B 72                  370 	ld	(hl),d
   017C C3r04s02            371 	jp	00115$
   017F                     372 00104$:
                            373 ;../_realloc.c:128: ret = malloc(size - HEADER_SIZE);
   017F F8 0F               374 	ldhl	sp,#15
   0181 2B                  375 	dec	hl
   0182 5E                  376 	ld	e,(hl)
   0183 23                  377 	inc	hl
   0184 56                  378 	ld	d,(hl)
   0185 21 06 00            379 	ld	hl,#0x0006
   0188 7B                  380 	ld	a,e
   0189 95                  381 	sub	a,l
   018A 5F                  382 	ld	e,a
   018B 7A                  383 	ld	a,d
   018C 9C                  384 	sbc	a,h
   018D 47                  385 	ld	b,a
   018E 4B                  386 	ld	c,e
   018F C5                  387 	push	bc
   0190 CDr00s00            388 	call	_malloc
   0193 E8 02               389 	lda	sp,2(sp)
   0195 42                  390 	ld	b,d
   0196 4B                  391 	ld	c,e
   0197 F8 04               392 	ldhl	sp,#4
   0199 71                  393 	ld	(hl),c
   019A 23                  394 	inc	hl
   019B 70                  395 	ld	(hl),b
                            396 ;../_realloc.c:129: if (ret)
   019C 2B                  397 	dec	hl
   019D 7E                  398 	ld	a,(hl)
   019E 23                  399 	inc	hl
   019F B6                  400 	or	a,(hl)
   01A0 CAr04s02            401 	jp	Z,00115$
                            402 ;../_realloc.c:131: memcpy(ret, MEM(pthis), pthis->len - HEADER_SIZE);
   01A3 F8 09               403 	ldhl	sp,#9
   01A5 2B                  404 	dec	hl
   01A6 5E                  405 	ld	e,(hl)
   01A7 23                  406 	inc	hl
   01A8 56                  407 	ld	d,(hl)
   01A9 21 04 00            408 	ld	hl,#0x0004
   01AC 19                  409 	add	hl,de
   01AD 4D                  410 	ld	c,l
   01AE 44                  411 	ld	b,h
   01AF 59                  412 	ld	e,c
   01B0 50                  413 	ld	d,b
   01B1 1A                  414 	ld	a,(de)
   01B2 4F                  415 	ld	c,a
   01B3 13                  416 	inc	de
   01B4 1A                  417 	ld	a,(de)
   01B5 47                  418 	ld	b,a
   01B6 11 06 00            419 	ld	de,#0x0006
   01B9 79                  420 	ld	a,c
   01BA 93                  421 	sub	a,e
   01BB 5F                  422 	ld	e,a
   01BC 78                  423 	ld	a,b
   01BD 9A                  424 	sbc	a,d
   01BE F8 01               425 	ldhl	sp,#1
   01C0 77                  426 	ld	(hl),a
   01C1 2B                  427 	dec	hl
   01C2 73                  428 	ld	(hl),e
   01C3 F8 09               429 	ldhl	sp,#9
   01C5 2B                  430 	dec	hl
   01C6 5E                  431 	ld	e,(hl)
   01C7 23                  432 	inc	hl
   01C8 56                  433 	ld	d,(hl)
   01C9 21 06 00            434 	ld	hl,#0x0006
   01CC 19                  435 	add	hl,de
   01CD 4D                  436 	ld	c,l
   01CE 44                  437 	ld	b,h
   01CF F8 00               438 	ldhl	sp,#0
   01D1 7E                  439 	ld	a,(hl)
   01D2 23                  440 	inc	hl
   01D3 66                  441 	ld	h,(hl)
   01D4 6F                  442 	ld	l,a
   01D5 E5                  443 	push	hl
   01D6 C5                  444 	push	bc
   01D7 F8 08               445 	ldhl	sp,#8
   01D9 7E                  446 	ld	a,(hl)
   01DA 23                  447 	inc	hl
   01DB 66                  448 	ld	h,(hl)
   01DC 6F                  449 	ld	l,a
   01DD E5                  450 	push	hl
   01DE CDr00s00            451 	call	_memcpy
   01E1 E8 06               452 	lda	sp,6(sp)
                            453 ;../_realloc.c:132: free(p);
   01E3 F8 0C               454 	ldhl	sp,#12
   01E5 7E                  455 	ld	a,(hl)
   01E6 23                  456 	inc	hl
   01E7 66                  457 	ld	h,(hl)
   01E8 6F                  458 	ld	l,a
   01E9 E5                  459 	push	hl
   01EA CDr00s00            460 	call	_free
   01ED E8 02               461 	lda	sp,2(sp)
   01EF 18 13               462 	jr	00115$
   01F1                     463 00114$:
                            464 ;../_realloc.c:140: ret = malloc(size);
   01F1 F8 0E               465 	ldhl	sp,#14
   01F3 7E                  466 	ld	a,(hl)
   01F4 23                  467 	inc	hl
   01F5 66                  468 	ld	h,(hl)
   01F6 6F                  469 	ld	l,a
   01F7 E5                  470 	push	hl
   01F8 CDr00s00            471 	call	_malloc
   01FB E8 02               472 	lda	sp,2(sp)
   01FD 42                  473 	ld	b,d
   01FE 4B                  474 	ld	c,e
   01FF F8 04               475 	ldhl	sp,#4
   0201 71                  476 	ld	(hl),c
   0202 23                  477 	inc	hl
   0203 70                  478 	ld	(hl),b
   0204                     479 00115$:
   0204 FB                  480 	ei
                            481 ;../_realloc.c:143: return ret;
   0205 F8 05               482 	ldhl	sp,#5
   0207 2B                  483 	dec	hl
   0208 5E                  484 	ld	e,(hl)
   0209 23                  485 	inc	hl
   020A 56                  486 	ld	d,(hl)
   020B                     487 00116$:
   020B E8 0A               488 	lda	sp,10(sp)
   020D C9                  489 	ret
   020E                     490 _realloc_end::
                            491 	.area _CODE
                            492 	.area _CABS
